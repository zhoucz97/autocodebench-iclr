# å¤šè¯­è¨€ä»£ç æ²™ç›’æœåŠ¡

ä¸€ä¸ªå®‰å…¨ã€é«˜æ€§èƒ½çš„å¤šè¯­è¨€ä»£ç æ‰§è¡Œæ²™ç›’æœåŠ¡ï¼Œæ”¯æŒ30+ç§ç¼–ç¨‹è¯­è¨€çš„ä»£ç ç¼–è¯‘å’Œæ‰§è¡Œã€‚

## ğŸš€ ç‰¹æ€§

- **å¤šè¯­è¨€æ”¯æŒ**ï¼šæ”¯æŒ30+ç§ç¼–ç¨‹è¯­è¨€ï¼ŒåŒ…æ‹¬Pythonã€JavaScriptã€Goã€Javaã€C++ã€Rustç­‰
- **å®‰å…¨éš”ç¦»**ï¼šåŸºäºDockerå®¹å™¨å’Œiptablesé˜²ç«å¢™è§„åˆ™ï¼Œç¡®ä¿ä»£ç æ‰§è¡Œå®‰å…¨
- **æ™ºèƒ½ä»£ç æ‹¼æ¥**ï¼šè‡ªåŠ¨å¤„ç†å‡½æ•°ä»£ç å’Œæµ‹è¯•ä»£ç çš„æ‹¼æ¥ï¼Œæ”¯æŒå¤šç§è¯­è¨€ç‰¹å®šçš„è¯­æ³•
- **é«˜æ€§èƒ½**ï¼šåŸºäºGunicornå¤šè¿›ç¨‹æ¶æ„ï¼Œæ”¯æŒå¹¶å‘æ‰§è¡Œ
- **RESTful API**ï¼šæä¾›ç®€æ´çš„HTTP APIæ¥å£

## ğŸ“‹ æ”¯æŒçš„ç¼–ç¨‹è¯­è¨€

- **C** - ä½¿ç”¨gccç¼–è¯‘
- **C#** - ä½¿ç”¨.NET Coreè¿è¡Œæ—¶
- **C++** - ä½¿ç”¨g++ç¼–è¯‘
- **CoffeeScript** - ç¼–è¯‘åˆ°JavaScript
- **Common Lisp** - ä½¿ç”¨SBCLè§£é‡Šå™¨
- **Dart** - æ”¯æŒæ–­è¨€æ£€æŸ¥
- **Elixir** - åŸºäºErlang VM
- **Emacs Lisp** - ä½¿ç”¨Emacsæ‰¹å¤„ç†æ¨¡å¼
- **Erlang** - ä½¿ç”¨erlcç¼–è¯‘å™¨
- **F#** - åŸºäº.NETå¹³å°
- **Fortran** - ä½¿ç”¨gfortranç¼–è¯‘å™¨
- **Go** - ä½¿ç”¨goç¼–è¯‘å™¨
- **Groovy** - ä½¿ç”¨groovyè§£é‡Šå™¨
- **Haskell** - ä½¿ç”¨GHCç¼–è¯‘å™¨
- **Java** - é›†æˆJUnitæµ‹è¯•æ¡†æ¶
- **JavaScript** - ä½¿ç”¨Node.jsè¿è¡Œæ—¶
- **Julia** - ä½¿ç”¨juliaè§£é‡Šå™¨
- **Kotlin** - ä½¿ç”¨kotlincè„šæœ¬æ¨¡å¼
- **Lua** - ä½¿ç”¨luaè§£é‡Šå™¨
- **Pascal** - ä½¿ç”¨Free Pascalç¼–è¯‘å™¨
- **Perl** - ä½¿ç”¨perlè§£é‡Šå™¨
- **PHP** - ä½¿ç”¨phpè§£é‡Šå™¨
- **PowerShell** - ä½¿ç”¨pwshæ‰§è¡Œ
- **Python** - ä½¿ç”¨python3è§£é‡Šå™¨
- **R** - ä½¿ç”¨Rscriptæ‰§è¡Œ
- **Racket** - ä½¿ç”¨racketè§£é‡Šå™¨
- **Ruby** - ä½¿ç”¨rubyè§£é‡Šå™¨
- **Rust** - ä½¿ç”¨Cargoæ„å»ºç³»ç»Ÿ
- **Scala** - ä½¿ç”¨Ammonite REPL
- **Scheme** - ä½¿ç”¨Racketæ‰§è¡Œ
- **Shell** - ä½¿ç”¨bashæ‰§è¡Œ
- **Swift** - ä½¿ç”¨swiftè§£é‡Šå™¨
- **Tcl** - ä½¿ç”¨tclshæ‰§è¡Œ
- **TypeScript** - ä½¿ç”¨tsxæ‰§è¡Œ
- **Vimscript** - ä½¿ç”¨vimæ‰§è¡Œ
- **Visual Basic** - åŸºäº.NETå¹³å°

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HTTP Client  â”‚â”€â”€â”€â–¶â”‚  Flask Web   â”‚â”€â”€â”€â–¶â”‚    Executor    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚                    â”‚
                           â”‚                    â”‚
                           â–¼                    â–¼ 
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Code Splicer â”‚    â”‚ Safe Subprocessâ”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚                     
                           â–¼                     
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    
                    â”‚  Code Store  â”‚     
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Config File  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

#### 1. WebæœåŠ¡å±‚
- **Flaskåº”ç”¨**ï¼šæä¾›HTTPæ¥å£ï¼Œå¤„ç†ä»£ç æ‰§è¡Œå’Œæ‹¼æ¥è¯·æ±‚
- **ä¸»è¦ç«¯ç‚¹**ï¼š
  - `/submit` - ä»£ç æ‰§è¡ŒæœåŠ¡
- **åŠŸèƒ½**ï¼šè¯·æ±‚éªŒè¯ã€å¼‚å¸¸å¤„ç†ã€å“åº”æ ¼å¼åŒ–

#### 2. ä»£ç å¤„ç†å±‚
- **ä»£ç æ‹¼æ¥å™¨**ï¼šæ™ºèƒ½åˆå¹¶å‡½æ•°ä»£ç å’Œæµ‹è¯•ä»£ç 
  - å¤šè¯­è¨€è¯­æ³•é€‚é…ï¼ˆGo importåˆå¹¶ã€JSå‡½æ•°æ£€æµ‹ç­‰ï¼‰
  - ä»£ç ç»“æ„åˆ†æå’Œä¼˜åŒ–
- **ä»£ç å­˜å‚¨å™¨**ï¼šç®¡ç†ä¸´æ—¶æ‰§è¡Œç¯å¢ƒ
  - æ–‡ä»¶åˆ›å»ºå’Œæ¸…ç†
  - è¯­æ³•é¢„æ£€æŸ¥
  - æƒé™æ§åˆ¶

#### 3. æ‰§è¡Œæ§åˆ¶å±‚
- **ä»£ç æ‰§è¡Œå™¨**ï¼šç»Ÿä¸€çš„å¤šè¯­è¨€æ‰§è¡Œç®¡ç†
  - ç¼–è¯‘å™¨/è§£é‡Šå™¨è°ƒåº¦
  - æ‰§è¡Œæµç¨‹æ§åˆ¶
  - é”™è¯¯ä¿¡æ¯æ”¶é›†
- **å®‰å…¨å­è¿›ç¨‹**ï¼šåº•å±‚å®‰å…¨æ‰§è¡Œä¿éšœ
  - æƒé™éš”ç¦»
  - èµ„æºé™åˆ¶
  - è¶…æ—¶æ§åˆ¶

### å®‰å…¨æœºåˆ¶

#### 1. å®¹å™¨éš”ç¦»
- åŸºäºDockerå®¹å™¨è¿è¡Œï¼Œä¸å®¿ä¸»æœºå®Œå…¨éš”ç¦»
- ä½¿ç”¨éç‰¹æƒç”¨æˆ·æ‰§è¡Œä»£ç 
- é™åˆ¶æ–‡ä»¶ç³»ç»Ÿè®¿é—®æƒé™

#### 2. ç½‘ç»œå®‰å…¨
- iptablesé˜²ç«å¢™è§„åˆ™ä¸¥æ ¼æ§åˆ¶ç½‘ç»œè®¿é—®
- ä»…å…è®¸å¿…è¦çš„å‡ºç«™è¿æ¥ï¼ˆDNSã€é•œåƒæºã€æ—¥å¿—æœåŠ¡ï¼‰
- é»˜è®¤æ‹’ç»æ‰€æœ‰å…¶ä»–ç½‘ç»œæµé‡

#### 3. èµ„æºé™åˆ¶
- CPUå’Œå†…å­˜ä½¿ç”¨é™åˆ¶
- æ‰§è¡Œæ—¶é—´è¶…æ—¶æ§åˆ¶
- æ–‡ä»¶ç³»ç»Ÿå†™å…¥é™åˆ¶

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æ‹‰å–é•œåƒ

```bash
docker pull your-registry/multi-language-sandbox:latest
```

### 2. å¯åŠ¨æœåŠ¡
```bash
docker run -d \
  --name sandbox-service \
  -p 8080:8080 \
  --cap-add=NET_ADMIN \
  your-registry/multi-language-sandbox:latest
```

### 3. éªŒè¯æœåŠ¡

æœåŠ¡å¯åŠ¨åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š

```bash
# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps | grep sandbox

# æµ‹è¯•æœåŠ¡å¥åº·çŠ¶æ€
curl -X POST http://localhost:8080/submit \
  -H "Content-Type: application/json" \
  -d '{"src_uid": "test-001", "lang": "python", "source_code": "print(\"Hello World\")"}'
```

å¦‚æœè¿”å›åŒ…å« `"exec_outcome": "PASSED"` çš„JSONå“åº”ï¼Œè¯´æ˜æœåŠ¡è¿è¡Œæ­£å¸¸ã€‚

## ğŸ“¡ APIæ¥å£

### 1. ä»£ç æ‰§è¡Œæ¥å£

**ç«¯ç‚¹**ï¼š`POST /submit` ï¼ˆä½¿ç”¨source_codeï¼‰

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "src_uid": "unique-request-id",
  "lang": "python",
  "source_code": "def hello():\n    print('Hello World')\nhello()",
  "request_extensions": {
    "timeout": 10,
    "debug": false
  },
  "show_log": true
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "src_uid": "unique-request-id",
  "all_code": "",
  "exec_cout": "Hello World\n",
  "exec_outcome": "PASSED",
  "exec_compile_message": "",
  "exec_runtime_message": "",
  "response_extensions": {
    "server_ip": "172.17.0.2",
    "exec_runtime": 0.123,
    "outcome": "PASSED",
    "stdout": "Hello World\n",
    "stderr": ""
  }
}
```

### 2. ä»£ç æ‹¼æ¥åæ‰§è¡Œæ¥å£

**ç«¯ç‚¹**ï¼š`POST /submit`ï¼ˆä½¿ç”¨func_codeå’Œmain_codeï¼‰

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "src_uid": "unique-request-id",
  "lang": "go",
  "func_code": "package main\n\nfunc add(a, b int) int {\n    return a + b\n}",
  "main_code": "package main\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(add(1, 2))\n}",
  "request_extensions": {
    "timeout": 5
  }
}
```

## ğŸ”§ ä½¿ç”¨ç¤ºä¾‹

### Pythonä»£ç æ‰§è¡Œ
```bash
curl -X POST http://localhost:8080/submit \
  -H "Content-Type: application/json" \
  -d '{
    "src_uid": "python-test-001",
    "lang": "python",
    "source_code": "def fibonacci(n):\n    if n <= 1:\n        return n\n    return fibonacci(n-1) + fibonacci(n-2)\n\nprint(fibonacci(10))"
  }'
```

### JavaScriptä»£ç æ‹¼æ¥åæ‰§è¡Œ
```bash
curl -X POST http://localhost:8080/submit \
  -H "Content-Type: application/json" \
  -d '{
    "src_uid": "js-test-001",
    "lang": "javascript",
    "func_code": "\n// Function to calculate the number of structurally unique BSTs for a given n\nconst countUniqueBSTs = (n) => {\n    // Handle edge cases\n    if (n <= 0) return 0;\n    if (n === 1) return 1;\n    \n    // Create a DP array to store results of subproblems\n    const dp = new Array(n + 1).fill(0);\n    dp[0] = 1; // Base case: empty tree\n    dp[1] = 1; // Base case: single node\n    \n    // Fill the DP array in bottom-up manner\n    for (let i = 2; i <= n; i++) {\n        for (let j = 0; j < i; j++) {\n            // The number of trees when j is the root\n            dp[i] += dp[j] * dp[i - j - 1];\n        }\n    }\n    \n    return dp[n];\n};\n",
    "main_code": "\nconst assert = require(\"assert\");\n\nconst demoTesting = () => {\n    assert.strictEqual(countUniqueBSTs(2), 2);\n    assert.strictEqual(countUniqueBSTs(3), 5);\n};\n"
  }'
```

### Goä»£ç æ‹¼æ¥åæ‰§è¡Œ
```bash
curl -X POST http://localhost:8080/submit \
  -H "Content-Type: application/json" \
  -d '{
    "src_uid": "go-test-001",
    "lang": "go",
    "func_code": "package main\n\nfunc isPrime(n int) bool {\n    if n < 2 { return false }\n    for i := 2; i*i <= n; i++ {\n        if n%i == 0 { return false }\n    }\n    return true\n}",
    "main_code": "package main\nimport \"fmt\"\n\nfunc main() {\n    for i := 2; i <= 20; i++ {\n        if isPrime(i) {\n            fmt.Printf(\"%d \", i)\n        }\n    }\n    fmt.Println()\n}"
  }'
```

### Javaä»£ç æ‹¼æ¥åæ‰§è¡Œ
```bash
curl -X POST http://localhost:8080/submit \
  -H "Content-Type: application/json" \
  -d '{
    "src_uid": "java-test-001",
    "lang": "java",
    "func_code": "import java.util.List;\n\nclass WineGlassMaximizer {\n    /**\n     * Calculates the maximum amount of wine that can be consumed without drinking\n     * three glasses in a row, using dynamic programming.\n     * \n     * @param glasses List of wine glass amounts\n     * @return Maximum amount that can be consumed following the rules\n     */\n    public int maxWineConsumption(List<Integer> glasses) {\n        if (glasses.isEmpty()) return 0;\n        if (glasses.size() == 1) return glasses.get(0);\n        if (glasses.size() == 2) return glasses.get(0) + glasses.get(1);\n        \n        int n = glasses.size();\n        int[] dp = new int[n];\n        \n        dp[0] = glasses.get(0);\n        dp[1] = glasses.get(0) + glasses.get(1);\n        dp[2] = Math.max(Math.max(glasses.get(0) + glasses.get(2), glasses.get(1) + glasses.get(2)), dp[1]);\n        \n        for (int i = 3; i < n; i++) {\n            dp[i] = Math.max(\n                Math.max(\n                    dp[i-3] + glasses.get(i-1) + glasses.get(i), // skip two, then take two\n                    dp[i-2] + glasses.get(i)                     // skip one, then take one\n                ),\n                dp[i-1]                                         // skip current glass\n            );\n        }\n        \n        return dp[n-1];\n    }\n}",
    "main_code": "import static org.junit.jupiter.api.Assertions.assertEquals;\nimport org.junit.jupiter.api.Test;\nimport java.util.Arrays;\nimport java.util.List;\n\nclass TestWineGlassMaximizer {\n    @Test\n    public void test() {\n        WineGlassMaximizer maximizer = new WineGlassMaximizer();\n        \n        List<Integer> input1 = Arrays.asList(1, 2, 3, 4, 5);\n        assertEquals(12, maximizer.maxWineConsumption(input1));\n        \n        List<Integer> input2 = Arrays.asList(5, 5, 5, 5);\n        assertEquals(15, maximizer.maxWineConsumption(input2));\n    }\n}"
  }'
```

## ğŸ“Š æ‰§è¡Œç»“æœçŠ¶æ€

| çŠ¶æ€ | è¯´æ˜ |
|------|------|
| `PASSED` | ä»£ç æ‰§è¡ŒæˆåŠŸ |
| `COMPILATION_ERROR` | ç¼–è¯‘é”™è¯¯ |
| `RUNTIME_ERROR` | è¿è¡Œæ—¶é”™è¯¯ |
| `TIMEOUT` | æ‰§è¡Œè¶…æ—¶ |
| `SYNTAX_ERROR` | è¯­æ³•é”™è¯¯ |
| `ARGUMENT_ERROR` | å‚æ•°é”™è¯¯ |
| `INTERNAL_ERROR` | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

## ğŸ” ç›‘æ§å’Œæ—¥å¿—

### æ—¥å¿—æ–‡ä»¶
- **ä½ç½®**ï¼š`/data/logs/`
- **æ ¼å¼**ï¼šJSONæ ¼å¼ï¼ŒåŒ…å«è¯·æ±‚IDã€æ‰§è¡Œæ—¶é—´ã€ç»“æœçŠ¶æ€ç­‰
- **è½®è½¬**ï¼šè‡ªåŠ¨æŒ‰æ—¥æœŸè½®è½¬

### æ€§èƒ½ç›‘æ§
- **è¯·æ±‚è¿½è¸ª**ï¼šæ¯ä¸ªè¯·æ±‚éƒ½æœ‰å”¯ä¸€çš„src_uidè¿›è¡Œè¿½è¸ª
- **èµ„æºä½¿ç”¨**ï¼šCPUã€å†…å­˜ã€æ‰§è¡Œæ—¶é—´ç»Ÿè®¡

## ğŸ›¡ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹

1. **ç½‘ç»œéš”ç¦»**ï¼šç¡®ä¿å®¹å™¨ç½‘ç»œé…ç½®æ­£ç¡®ï¼Œé¿å…è®¿é—®å†…ç½‘èµ„æº
2. **èµ„æºé™åˆ¶**ï¼šæ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´CPUå’Œå†…å­˜é™åˆ¶
3. **æƒé™æ§åˆ¶**ï¼šä¸è¦ä»¥rootç”¨æˆ·è¿è¡Œå®¹å™¨
4. **å®šæœŸæ›´æ–°**ï¼šåŠæ—¶æ›´æ–°åŸºç¡€é•œåƒå’Œä¾èµ–åŒ…
5. **ç›‘æ§å‘Šè­¦**ï¼šå»ºè®®é…ç½®å¼‚å¸¸æ‰§è¡Œçš„ç›‘æ§å‘Šè­¦

## ğŸ’¬ åé¦ˆä¸æ”¯æŒ

å¦‚æœåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œæ¬¢è¿ï¼š

- æäº¤IssueæŠ¥å‘Šé—®é¢˜
- åˆ†äº«ä½¿ç”¨ç»éªŒå’Œæœ€ä½³å®è·µ
- å»ºè®®æ–°çš„è¯­è¨€æ”¯æŒéœ€æ±‚


## ğŸ†˜ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: å®¹å™¨å¯åŠ¨å¤±è´¥ï¼Œæç¤ºæƒé™é”™è¯¯**
A: ç¡®ä¿Dockeræœ‰è¶³å¤Ÿæƒé™ï¼Œå¹¶æ·»åŠ `--cap-add=NET_ADMIN`å‚æ•°

**Q: ä»£ç æ‰§è¡Œè¶…æ—¶**
A: æ£€æŸ¥timeoutå‚æ•°è®¾ç½®ï¼Œå¤æ‚ç®—æ³•å¯èƒ½éœ€è¦æ›´é•¿æ—¶é—´

**Q: æŸäº›è¯­è¨€ç¼–è¯‘å¤±è´¥**
A: æ£€æŸ¥è¯­è¨€ç¯å¢ƒæ˜¯å¦æ­£ç¡®å®‰è£…ï¼ŒæŸ¥çœ‹ç¼–è¯‘é”™è¯¯ä¿¡æ¯

**Q: ç½‘ç»œè¿æ¥é—®é¢˜**
A: æ£€æŸ¥iptablesè§„åˆ™ï¼Œç¡®ä¿å¿…è¦çš„ç½‘ç»œè®¿é—®è¢«å…è®¸

### è°ƒè¯•æ¨¡å¼

å¯ç”¨è°ƒè¯•æ¨¡å¼ä¿ç•™ä¸´æ—¶æ–‡ä»¶ï¼š
```json
{
  "request_extensions": {
    "debug": true
  }
}
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs sandbox-service

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker exec sandbox-service tail -f /data/logs/sandbox.log
```